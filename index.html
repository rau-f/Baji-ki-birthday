<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Gulshan - A Special Journey</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Montserrat:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <!-- Icons (CDN for portability, reliable for online sharing) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg-dark: #0a0e27;
            --bg-deep: #050716;
            --gold: #d4af37;
            --gold-light: #f4d03f;
            --pink: #ff1493;
            --white: #ffffff;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(212, 175, 55, 0.2);
            --font-heading: 'Playfair Display', serif;
            --font-body: 'Montserrat', sans-serif;
            --transition-speed: 0.4s;
        }
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-body);
            background-color: var(--bg-dark);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }
        /* Typography */
        h1,
        h2,
        h3 {
            font-family: var(--font-heading);
            margin: 0;
        }
        .main-title {
            font-size: 4rem;
            line-height: 1.1;
            text-align: center;
            margin-bottom: 2rem;
        }
        .accent-font {
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
            color: var(--gold-light);
        }
        .highlight-name {
            color: var(--gold);
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
            font-style: italic;
        }
        .overline {
            text-transform: uppercase;
            letter-spacing: 3px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 1rem;
        }
        /* Buttons */
        .btn {
            padding: 1rem 2.5rem;
            border-radius: 50px;
            font-family: var(--font-body);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            border: none;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 1rem 0;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--gold), var(--gold-light));
            color: var(--bg-deep);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.6);
        }
        .btn-gold {
            background: var(--gold);
            color: var(--bg-deep);
        }
        .btn-outline {
            background: transparent;
            border: 1px solid var(--white);
            color: var(--white);
        }
        .icon-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--gold);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .icon-btn:hover {
            background: rgba(212, 175, 55, 0.2);
            border-color: var(--gold);
        }
        /* Layout */
        .content-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 10;
        }
        .centered {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 80vh;
            justify-content: center;
        }
        .full-height {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        /* Glass Panels */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .intro-card {
            max-width: 600px;
            margin: 2rem auto;
            font-size: 1.1rem;
        }
        /* Sections & Transitions */
        section {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            min-height: 100vh;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.8s ease, transform 0.8s ease;
            transform: translateY(20px);
        }
        section.active-section {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            z-index: 5;
            position: relative;
        }
        .hidden-element {
            display: none !important;
        }
        /* Puzzle 1: Memory Match */
        .game-stats-bar {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-bottom: 2rem;
            padding: 1rem 2rem;
        }
        .stat {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Montserrat', monospace;
            font-size: 1.2rem;
            color: var(--gold);
        }
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
            perspective: 1000px;
        }
        .card {
            background-color: transparent;
            width: 100%;
            aspect-ratio: 3/4;
            cursor: pointer;
            position: relative;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border-radius: 12px;
        }
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-front,
        .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--gold);
        }
        .card-front {
            background: linear-gradient(135deg, #1e3c72, #2a5298, #d4af37);
            background-size: 200% 200%;
            animation: gradientShift 5s ease infinite;
        }
        .card-back {
            background-color: white;
            color: black;
            transform: rotateY(180deg);
            padding: 10px;
        }
        .card.matched .card-inner {
            box-shadow: 0 0 15px var(--gold);
        }
        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        /* Puzzle 2: Unscramble */
        .slots-container {
            display: flex;
            gap: 15px;
            margin: 3rem 0;
            justify-content: center;
            flex-wrap: wrap;
        }
        .slot {
            width: 60px;
            height: 70px;
            border: 2px dashed rgba(212, 175, 55, 0.4);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-family: var(--font-heading);
            color: var(--gold);
            background: rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }
        .slot.filled {
            border-style: solid;
            border-color: var(--gold);
            background: rgba(212, 175, 55, 0.1);
        }
        .letters-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            min-height: 80px;
        }
        .letter-tile {
            width: 50px;
            height: 50px;
            background: #1a1d35;
            border: 1px solid var(--gold);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--white);
            cursor: grab;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%,
            100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }
        /* Puzzle 3: Hidden Heart */
        .discovery-canvas {
            position: relative;
            flex-grow: 1;
            width: 100%;
            margin: 2rem 0;
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            overflow: hidden;
        }
        .scattered-icon {
            position: absolute;
            color: rgba(255, 255, 255, 0.2);
            transition: transform 0.3s, color 0.3s;
            cursor: pointer;
        }
        .scattered-icon:hover {
            color: var(--gold);
            transform: scale(1.2);
        }
        .scattered-icon.heart-target:hover {
            color: var(--pink);
            filter: drop-shadow(0 0 10px var(--pink));
        }
        .pink-glow-text {
            color: var(--pink);
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 20, 147, 0.5);
        }
        /* Final Card */
        .final-card-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .card-image-wrapper {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            height: 100%;
            min-height: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--gold);
        }
        .card-hero-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 5s ease;
        }
        .card-image-wrapper:hover .card-hero-img {
            transform: scale(1.05);
        }
        .overlay-text {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            padding: 2rem;
            font-family: var(--font-heading);
            font-size: 2rem;
            color: var(--gold);
        }
        .theme-list {
            list-style: none;
            padding: 0;
            margin-top: 2rem;
        }
        .theme-list li {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Montserrat';
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }
        .icon-gold {
            color: var(--gold);
        }
        .icon-pink {
            color: var(--pink);
        }
        .signature {
            margin-top: 2rem;
            text-align: right;
            font-family: var(--font-heading);
            color: var(--gold);
        }
        .final-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            padding-bottom: 2rem;
        }
        /* Loader */
        #loader {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: #0a0e27;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            transition: opacity 0.8s ease;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(212, 175, 55, 0.3);
            border-radius: 50%;
            border-top-color: #d4af37;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        @keyframes celebrationPulse {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        @keyframes confettiSwing {
            0%, 100% {
                transform: translateX(0);
            }
            25% {
                transform: translateX(30px);
            }
            75% {
                transform: translateX(-30px);
            }
        }
        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }
        @keyframes fadeInOut {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }
        /* Background Stars */
        .stars-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
        }
        /* Audio Controls */
        .audio-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }
        /* Responsive */
        @media (max-width: 900px) {
            .memory-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            .final-card-container {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 600px) {
            .main-title {
                font-size: 2.5rem;
            }
            .memory-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            .slots-container {
                gap: 15px;
            }
            .slot {
                width: 50px;
                height: 60px;
                font-size: 1.5rem;
            }

            .glass-panel {
                padding: 1rem;
            }
            .intro-card {
                font-size: 0.9rem;
            }

            .section-title {
                font-size: 2rem;
            }
            .puzzle3 {
                font-size: 1.2rem;
            }

            .btn {
                padding: 0.6rem 1rem;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Audio -->
    <div class="audio-controls">
        <button id="music-btn" class="icon-btn" aria-label="Toggle Music"><i data-lucide="music"></i></button>
        <button id="sound-btn" class="icon-btn" aria-label="Toggle Sound Effects"><i
                data-lucide="volume-2"></i></button>
    </div>
    <audio id="bg-music" loop autoplay muted>
        <source src="./happy-birthday.mp3" type="audio/mpeg">
    </audio>
    <audio id="celebration-sound">
        <source src="https://assets.mixkit.co/active_sound/preview/active_sound_applause_with_whistles_crowd_cheer_1_3d4a2a0e.mp3" type="audio/mpeg">
    </audio>
    <!-- Celebration Container -->
    <div id="celebration-overlay" style="display: none; position: fixed; inset: 0; z-index: 5000; pointer-events: none;">
        <div id="confetti-container" style="position: absolute; width: 100%; height: 100%;"></div>
        <div id="celebration-text" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; font-family: 'Playfair Display', serif; color: var(--gold); text-shadow: 0 0 40px rgba(212, 175, 55, 0.8); white-space: nowrap; animation: celebrationPulse 1.5s ease-out;"></div>
    </div>
    <!-- Loader -->
    <div id="loader">
        <div class="spinner"></div>
        <p style="margin-top: 20px; font-family: 'Montserrat', sans-serif; color: #d4af37; letter-spacing: 2px;">
            PREPARING SURPRISE...</p>
    </div>
    <!-- Background -->
    <div class="stars-container"></div>
    <main id="app-container">
        <!-- Introduction -->
        <section id="intro-screen" class="active-section">
            <div class="content-wrapper centered">
                <p class="overline">Part 1: The Invitation</p>
                <h1 class="main-title">Happy 23rd <br> <span class="accent-font">Birthday</span> <br> <span
                        class="highlight-name">Gulshan!</span></h1>
                <div class="intro-card glass-panel">
                    <p>My dearest sister, even though I'm far away in distance, my love and wishes for you on your
                        special day know no bounds.</p>
                    <p>This year, I've curated a series of special moments just for you. To unlock your birthday
                        celebration, you'll need to navigate through a journey of our shared memories. Are you ready for
                        the first challenge?</p>
                </div>
                <button id="start-btn" class="btn btn-primary glow-effect">Begin the Celebration! <i data-lucide="gift"
                        style="margin-left:8px;"></i></button>
                <div class="phase-indicator"
                    style="margin-top: 2rem; color: rgba(255,255,255,0.4); text-transform: uppercase; font-size: 0.8rem; letter-spacing: 2px;">
                    Phase 1 of 3: The Gift Reveal</div>
            </div>
        </section>
        <!-- Puzzle 1 -->
        <section id="puzzle-1" class="hidden-section">
            <div class="content-wrapper">
                <header class="puzzle-header" style="text-align:center; margin-bottom: 2rem;">
                    <h2 class="section-title">Puzzle I</h2>
                    <p class="section-subtitle" style="color: var(--gold);">Memory Match Challenge</p>
                </header>
                <div class="game-stats-bar glass-panel">
                    <div class="stat"><i data-lucide="timer"></i> <span id="p1-timer">00:00</span></div>
                    <div class="stat"><i data-lucide="dice-5"></i> <span id="p1-moves">Moves: 0</span></div>
                </div>
                <div class="memory-grid" id="memory-grid"></div>
                <div class="footer-msg" style="text-align:center; position: bottom; margin-top:2rem; font-size:0.9rem; opacity:0.7;">Happy
                    23rd Birthday Gulshan</div>
            </div>
        </section>
        <!-- Puzzle 2 -->
        <section id="puzzle-2" class="hidden-section">
            <div class="content-wrapper centered">
                <header class="puzzle-header">
                    <p class="overline">Puzzle 2 of 3</p>
                    <h2 class="section-title">Unscramble the Wish</h2>
                    <p class="instruction-text" style="max-width: 600px; margin: 1rem 0;">Rearrange the shimmering
                        golden letters to reveal a special truth. Drag or click to place them.</p>
                </header>
                <div id="word-slots" class="slots-container"></div>
                <div id="letter-pool" class="letters-container"></div>
                <button id="p2-next-btn" class="btn btn-primary hidden-element">Unlock Final Puzzle <i
                        data-lucide="arrow-right"></i></button>
                <p class="footer-msg"
                    style="margin-top:2rem; text-transform: uppercase; letter-spacing: 2px; font-size: 0.8rem;">
                    Celebrating 23 Radiant Years</p>
            </div>
        </section>
        <!-- Puzzle 3 -->
        <section id="puzzle-3" class="hidden-section">
            <div class="content-wrapper full-height">
                <header class="puzzle-header overlay-header" style="padding: 1rem;">
                    <h2 class="section-title puzzle3"><i data-lucide="star" class="icon-gold"></i> Puzzle 3: The Hidden Heart
                    </h2>
                </header>
                <div class="center-instruction" style="text-align: center;">
                    <h1 class="big-msg" style="font-size: 2rem;">One Last Secret...</h1>
                    <p style="max-width: 600px; margin: 0 auto;">Gulshan, you've conquered every challenge. The gateway
                        to your 23rd birthday card lies hidden in this midnight celebration. Search for the <span
                            class="pink-glow-text">Glow of the Heart</span> amidst the gold and silver outlines.</p>
                </div>
                <div id="hidden-canvas" class="discovery-canvas"></div>
                <div class="hint-box glass-panel" style="text-align: center; max-width: 500px; margin: 0 auto;">
                    <i data-lucide="lightbulb" class="icon-gold"></i> <span
                        style="font-family: 'Montserrat'; text-transform: uppercase; letter-spacing: 2px; font-size: 0.8rem; color: var(--gold);">Hint:
                        A pulsing pink glow amongst the gold shadows</span>
                </div>
            </div>
        </section>
        <!-- Final Reveal -->
        <section id="final-card" class="hidden-section">
            <div class="content-wrapper">
                <div class="final-card-container active-card">
                    <div class="card-left">
                        <div class="card-image-wrapper">
                            <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=1000&auto=format&fit=crop"
                                alt="Gulshan Artistic Portrait" class="card-hero-img">
                            <div class="overlay-text">Soul sisters forever...</div>
                        </div>
                    </div>
                    <div class="card-right glass-panel">
                        <div class="celebration-icons"><i data-lucide="stars" class="icon-gold"></i></div>
                        <h2>You Solved It!</h2>
                        <p class="completion-note">Every puzzle you completed was a small reminder of the journey we've
                            shared. From childhood secrets to adult dreams, you've always been my favorite person.</p>
                        <ul class="theme-list">
                            <li><i data-lucide="heart" class="icon-pink"></i> Boundless Love</li>
                            <li><i data-lucide="party-popper" class="icon-gold"></i> Endless Laughter</li>
                            <li><i data-lucide="star" class="icon-gold"></i> Golden Memories</li>
                        </ul>
                    </div>
                </div>
                <div class="message-panel glass-panel mt-4">
                    <div class="quote-block"
                        style="border-left: 3px solid var(--gold); padding-left: 1rem; margin-bottom: 1.5rem; font-style: italic; font-size: 1.2rem;">
                        "My dearest Gulshan, even though I'm far away in distance, my love and wishes for you on your
                        special day know no bounds."
                    </div>
                    <p class="body-msg">
                        Watching you grow into the incredible 23-year-old woman you are today has been the greatest
                        privilege. You carry such grace, intelligence, and a heart that could light up the entire world.
                        <br><br>
                        This interactive journey was just a small way to show you that no matter how many miles lie
                        between us, I am always right there by your side, cheering you on and celebrating every single
                        one of your victories. <br><br>
                        May this year be filled with unexpected joys, deep peace, and all the success your hard-working
                        soul deserves. Keep shining, keep dreaming, and never forget how deeply you are loved.
                    </p>
                    <div class="signature">
                        <p class="sig-title">With all my love, forever,</p>
                        <p class="sig-name">YOUR BIG SISTER</p>
                    </div>
                </div>
                <div class="final-actions">
                    <button class="btn btn-gold"
                        onclick="alert('Sharing functionality would open native share sheet!')"><i
                            data-lucide="share-2"></i> Share the Joy</button>
                    <button class="btn btn-outline" onclick="window.print()"><i data-lucide="download"></i> Save
                        Memory</button>
                </div>
            </div>
        </section>
    </main>
    <script>
        // Audio - Define first so it's available during init
        const bgMusic = document.getElementById('bg-music');
        const celebrationSound = document.getElementById('celebration-sound');
        const musicBtn = document.getElementById('music-btn');
        let isMusicPlaying = false;
        let areSoundEffectsEnabled = true;
        
        // State
        const state = {
            currentPuzzle: 0,
            p1: { timer: 0, moves: 0, timerInterval: null, matches: 0, locked: false, cards: [] },
            p2: { word: "AMAZING", currentSlots: Array(7).fill(null) }
        };
        const sections = {
            intro: document.getElementById('intro-screen'),
            p1: document.getElementById('puzzle-1'),
            p2: document.getElementById('puzzle-2'),
            p3: document.getElementById('puzzle-3'),
            final: document.getElementById('final-card'),
            loader: document.getElementById('loader')
        };
        // Init
        window.addEventListener('load', () => {
            setTimeout(() => {
                sections.loader.style.opacity = '0';
                setTimeout(() => { sections.loader.style.display = 'none'; }, 800);
            }, 1000);
            lucide.createIcons();
            // Auto-play background music with unmute
            setTimeout(() => {
                bgMusic.muted = false;
                bgMusic.play().then(() => {
                    musicBtn.innerHTML = '<i data-lucide="pause"></i>';
                    musicBtn.classList.add('active');
                    isMusicPlaying = true;
                }).catch(e => {
                    console.log("Autoplay blocked, will start on first interaction", e);
                });
            }, 500);
        });
        
        // Fallback: start music on first click if autoplay failed
        document.addEventListener('click', function startMusicOnClick() {
            if (!isMusicPlaying) {
                bgMusic.muted = false;
                bgMusic.play().then(() => {
                    musicBtn.innerHTML = '<i data-lucide="pause"></i>';
                    musicBtn.classList.add('active');
                    isMusicPlaying = true;
                    document.removeEventListener('click', startMusicOnClick);
                }).catch(e => console.log("Play failed", e));
            }
        });
        document.getElementById('start-btn').addEventListener('click', () => {
            playCelebration();
            transitionSection(sections.intro, sections.p1);
            startPuzzle1();
        });
        function transitionSection(from, to) {
            window.scrollTo(0, 0);
            from.classList.remove('active-section');
            from.style.opacity = '0';
            setTimeout(() => {
                from.classList.add('hidden-section');
                to.classList.remove('hidden-section');
                void to.offsetWidth;
                to.classList.add('active-section');
                to.style.opacity = '1';
                lucide.createIcons();
            }, 800);
        }
        
        musicBtn.addEventListener('click', () => {
            if (isMusicPlaying) {
                bgMusic.pause();
                musicBtn.innerHTML = '<i data-lucide="music"></i>';
                musicBtn.classList.remove('active');
            } else {
                bgMusic.play().catch(e => console.log("Audio play blocked", e));
                musicBtn.innerHTML = '<i data-lucide="pause"></i>';
                musicBtn.classList.add('active');
            }
            lucide.createIcons();
            isMusicPlaying = !isMusicPlaying;
        });
        
        document.getElementById('sound-btn').addEventListener('click', () => {
            areSoundEffectsEnabled = !areSoundEffectsEnabled;
            if (areSoundEffectsEnabled) {
                document.getElementById('sound-btn').classList.add('active');
            } else {
                document.getElementById('sound-btn').classList.remove('active');
            }
        });
        
        function playCelebration() {
            if (areSoundEffectsEnabled) {
                celebrationSound.currentTime = 0;
                celebrationSound.play().catch(e => console.log("Sound effect blocked", e));
            }
            createCelebration();
        }
        
        function createCelebration() {
            const overlay = document.getElementById('celebration-overlay');
            const confettiContainer = document.getElementById('confetti-container');
            
            // Show overlay
            overlay.style.display = 'block';
            
            // Create confetti pieces
            const confettiPieces = 50;
            for (let i = 0; i < confettiPieces; i++) {
                const confetti = document.createElement('div');
                const size = Math.random() * 10 + 5;
                const colors = ['#d4af37', '#f4d03f', '#ff1493', '#ffffff', '#00ffff'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                confetti.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    background: ${color};
                    border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                    left: ${Math.random() * 100}%;
                    top: -10px;
                    animation: confettiFall ${Math.random() * 3 + 2}s ease-in forwards, 
                               confettiSwing ${Math.random() * 2 + 1}s ease-in-out infinite;
                    animation-delay: ${Math.random() * 0.5}s;
                    opacity: ${Math.random() * 0.7 + 0.3};
                    box-shadow: 0 0 ${size}px ${color}80;
                `;
                confettiContainer.appendChild(confetti);
            }
            
            // Add screen flash
            const flash = document.createElement('div');
            flash.style.cssText = `
                position: fixed;
                inset: 0;
                background: rgba(212, 175, 55, 0.3);
                animation: fadeOut 0.8s ease-out forwards;
                z-index: 4999;
            `;
            overlay.appendChild(flash);
            
            // Hide after animation
            setTimeout(() => {
                confettiContainer.innerHTML = '';
                overlay.style.display = 'none';
                flash.remove();
            }, 4000);
        }
        // Puzzle 1
        const icons = ['camera', 'music', 'heart', 'star', 'gift', 'cake'];
        const p1Grid = document.getElementById('memory-grid');
        let flippedCards = [];
        function startPuzzle1() {
            const pairs = [...icons, ...icons].sort(() => Math.random() - 0.5);
            p1Grid.innerHTML = '';
            pairs.forEach((icon, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.id = index;
                card.dataset.icon = icon;
                card.innerHTML = `<div class="card-inner"><div class="card-front"></div><div class="card-back"><i data-lucide="${icon}"></i></div></div>`;
                card.addEventListener('click', () => handleCardClick(card));
                p1Grid.appendChild(card);
            });
            lucide.createIcons();
            state.p1.timerInterval = setInterval(() => {
                state.p1.timer++;
                const mins = Math.floor(state.p1.timer / 60).toString().padStart(2, '0');
                const secs = (state.p1.timer % 60).toString().padStart(2, '0');
                document.getElementById('p1-timer').innerText = `${mins}:${secs}`;
            }, 1000);
        }
        function handleCardClick(card) {
            if (state.p1.locked || card.classList.contains('flipped') || card.classList.contains('matched')) return;
            card.classList.add('flipped');
            flippedCards.push(card);
            if (flippedCards.length === 2) {
                state.p1.moves++;
                document.getElementById('p1-moves').innerText = `Moves: ${state.p1.moves}`;
                checkForMatch();
            }
        }
        function checkForMatch() {
            state.p1.locked = true;
            const [c1, c2] = flippedCards;
            if (c1.dataset.icon === c2.dataset.icon) {
                c1.classList.add('matched'); c2.classList.add('matched');
                state.p1.matches++; flippedCards = []; state.p1.locked = false;
                if (state.p1.matches === 6) {
                    clearInterval(state.p1.timerInterval);
                    playCelebration();
                    setTimeout(() => { transitionSection(sections.p1, sections.p2); initPuzzle2(); }, 1500);
                }
            } else {
                setTimeout(() => {
                    c1.classList.remove('flipped'); c2.classList.remove('flipped');
                    flippedCards = []; state.p1.locked = false;
                }, 1000);
            }
        }
        // Puzzle 2
        function initPuzzle2() {
            const word = "AMAZING";
            const scrambled = "NAZAMGI".split('');
            const pool = document.getElementById('letter-pool');
            const slotsDiv = document.getElementById('word-slots');
            slotsDiv.innerHTML = '';
            for (let i = 0; i < word.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.dataset.index = i;
                slot.addEventListener('click', () => returnLetterFromSlot(i));
                slotsDiv.appendChild(slot);
            }
            pool.innerHTML = '';
            scrambled.forEach((char, i) => {
                const letter = document.createElement('div');
                letter.className = 'letter-tile';
                letter.innerText = char;
                letter.id = `letter-${i}`;
                letter.addEventListener('click', () => autoPlaceLetter(letter));
                pool.appendChild(letter);
            });
        }
        function autoPlaceLetter(letter) {
            const slots = document.querySelectorAll('.slot');
            for (let slot of slots) {
                if (!slot.hasChildNodes()) {
                    slot.appendChild(letter);
                    slot.classList.add('filled');
                    checkWord();
                    break;
                }
            }
        }
        function returnLetterFromSlot(index) {
            // Simplification: letters only go one way for smoothness in this demo version
        }
        function checkWord() {
            const slots = document.querySelectorAll('.slot');
            let currentWord = "";
            let filledSlots = 0;
            slots.forEach(s => {
                if (s.hasChildNodes()) filledSlots++;
                currentWord += s.innerText;
            });
            
            if (currentWord === "AMAZING") {
                document.getElementById('p2-next-btn').classList.remove('hidden-element');
                slots.forEach(s => s.style.borderColor = 'var(--gold-light)');
            } else if (filledSlots === slots.length) {
                // All slots filled but wrong word - show message and reset
                showWrongMessage();
            }
        }
        
        function showWrongMessage() {
            const messages = [
                'Not quite! Try again.',
                'Oops! Give it another shot.',
                'Close, but not quite. Rearrange!',
                'Hmm, that\'s not it. Try once more.',
                'Nice try! Shuffle and try again.',
                'Not the right order. Go again!',
                'Almost there! Rearrange the letters.',
                'That\'s not it. Keep trying!',
                'Wrong order. Let\'s try again.',
                'Not quite right. Rearrange them!'
            ];
            
            const message = messages[Math.floor(Math.random() * messages.length)];
            const slots = document.querySelectorAll('.slot');
            
            // Show message
            const msgDiv = document.createElement('div');
            msgDiv.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(255, 20, 147, 0.9);
                color: white;
                padding: 1rem 2rem;
                border-radius: 20px;
                font-size: 1.2rem;
                font-weight: 600;
                z-index: 100;
                animation: fadeInOut 2s ease-in-out;
                font-family: 'Montserrat', sans-serif;
            `;
            msgDiv.textContent = message;
            document.body.appendChild(msgDiv);
            
            // Reset after 1 second
            setTimeout(() => {
                slots.forEach(slot => {
                    const letter = slot.firstChild;
                    if (letter) {
                        document.getElementById('letter-pool').appendChild(letter);
                        slot.innerHTML = '';
                        slot.classList.remove('filled');
                    }
                });
                msgDiv.remove();
                document.getElementById('p2-next-btn').classList.add('hidden-element');
            }, 1000);
        }
        document.getElementById('p2-next-btn').addEventListener('click', () => {
            playCelebration();
            transitionSection(sections.p2, sections.p3);
            initPuzzle3();
        });
        // Puzzle 3
        function initPuzzle3() {
            const canvas = document.getElementById('hidden-canvas');
            const iconsList = ['gift', 'party-popper', 'glass-water', 'cake-slice', 'gem'];
            for (let i = 0; i < 20; i++) {
                const iconWrapper = document.createElement('div');
                const iconName = iconsList[Math.floor(Math.random() * iconsList.length)];
                iconWrapper.className = 'scattered-icon';
                iconWrapper.innerHTML = `<i data-lucide="${iconName}"></i>`;
                const x = Math.random() * 90; const y = Math.random() * 90;
                iconWrapper.style.left = `${x}%`; iconWrapper.style.top = `${y}%`;
                iconWrapper.style.animationDelay = `${Math.random() * 5}s`;
                canvas.appendChild(iconWrapper);
            }
            const heartWrapper = document.createElement('div');
            heartWrapper.className = 'scattered-icon heart-target';
            heartWrapper.innerHTML = `<i data-lucide="heart"></i>`;
            heartWrapper.style.left = `${Math.random() * 80 + 10}%`;
            heartWrapper.style.top = `${Math.random() * 80 + 10}%`;
            heartWrapper.addEventListener('click', revealFinal);
            canvas.appendChild(heartWrapper);
            lucide.createIcons();
        }
        function revealFinal() {
            playCelebration();
            transitionSection(sections.p3, sections.final);
        }
    </script>
</body>
</html>